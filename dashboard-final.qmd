---
title: "World Happiness Report"
subtitle: "Happiness Trends and Contributing Factors (2011-2024)"
format: 
    dashboard:
        orientation: columns
execute:
  warning: false
  message: false
---

```{r}
#| label: setup
library(tidyverse)
library(patchwork)
library(quarto)
library(brand.yml)

whr <- read_csv(here::here("data/whr.csv"))

brand <- read_brand_yml("_brand.yml")

theme_whr <-
  theme_brand_ggplot2("_brand.yml") +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12)
  ) 
```

## 

```{r}
#| label: global-trends
#| title: Global average happiness

global_trends <- 
  whr |>
  group_by(year) |>
  summarise(
    mean_happiness = mean(ladder_score, na.rm = TRUE),
    median_happiness = median(ladder_score, na.rm = TRUE),
    min_happiness = min(ladder_score, na.rm = TRUE),
    max_happiness = max(ladder_score, na.rm = TRUE),
    countries_count = n(),
    .groups = 'drop'
  )

global_trends |> 
  ggplot(aes(x = year, y = mean_happiness)) +
  geom_line(color = brand$color$palette$teal, linewidth = 1.5) +
  geom_point(color = brand$color$palette$teal, size = 3) +
  labs(
    title = "Global Average Happiness Over Time (2011-2024)",
    subtitle = "Average happiness has increased over the past 12 years",
    x = "Year",
    y = "Average Happiness Score"
  ) +
  scale_x_continuous(breaks = seq(2011, 2024, 1)) +
  scale_y_continuous(limits = c(5.2, 5.7), breaks = seq(5.2, 5.7, 0.1)) +
  theme_whr +
  theme(
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) 
```

1. **Global happiness is gradually improving**: The world has become slightly happier over the past decade.

2. **Social connections and economic conditions are most important**: GDP per capita and social support are the strongest contributors to national happiness. 

3. **Multiple pathways to happiness**: The top countries show that there are different combinations of factors that can lead to high happiness levels.

5. **Crises can severely affect happiness**: Countries experiencing political upheaval or economic crisis show dramatic happiness declines.

##

###

```{r}
#| content: valuebox
#| title: "Happiest country 2024"
list(
  icon = "award-fill",
  color = brand$color$palette$teal,
  value = "Finland"
)
```

```{r}
#| content: valuebox
#| title: "Largest explanatory factor"
list(
  icon = "people-fill",
  color = brand$color$palette$dark_blue,
  value = "Social support"
)
```

### Increase/decrease plots {.tabset}


```{r}
#| label: country-changes
#| title: Improving countries

most_changed_countries <- 
  whr |>
  drop_na(year, ladder_score) |> 
  group_by(country_name) |>
  summarise(
    first_year = min(year),
    last_year = max(year),
    first_score = first(ladder_score, order_by = year),
    last_score = last(ladder_score, order_by = year),
    change = last_score - first_score,
    years_span = last_year - first_year,
    .groups = 'drop'
  ) |>
  filter(years_span >= 10) |> 
  group_by(improvement = change > 0) |> 
  slice_max(order_by = abs(change), n = 5) |> 
  ungroup() 

improvements_plot <- 
  whr |>
  inner_join(
    most_changed_countries |> filter(improvement == TRUE), 
    by = join_by(country_name)
    ) |> 
  ggplot(aes(x = year, y = ladder_score, color = country_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2.5) +
  scale_x_continuous(breaks = scales::breaks_width(3)) +
  labs(
    title = "National Happiness Score Over Time",
    subtitle = 
      "For countries with the largest increases in happiness since 2011",
    x = "Year",
    y = "Happiness Score",
    color = NULL
  ) +
  theme_whr

declines_plot <- 
  whr |>
  inner_join(
    most_changed_countries |> filter(improvement == FALSE), 
    by = join_by(country_name)
  ) |> 
  ggplot(aes(x = year, y = ladder_score, color = country_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2.5) +
  scale_x_continuous(breaks = scales::breaks_width(3)) +
  scale_color_manual(
    values = 
        c("#d62728", "#ff7f0e", "#8c564b", "#e377c2", "#7f7f7f")
  ) +
  labs(
    title = "National Happiness Score Over Time",
    subtitle = 
      "For countries with the largest decreases in happiness since 2011",
    x = "Year", 
    y = "Happiness Score",
    color = NULL
  ) +
  theme_whr


improvements_plot 
```

```{r}
#| label: decline-plot
#| title: Decreasing countries
declines_plot
```




